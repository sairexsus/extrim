<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('extrim.png') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    color: white;
    padding: 20px;
  }
  h1 {
    background: rgba(0,0,0,0.5);
    padding: 10px 20px;
    border-radius: 10px;
    margin-bottom: 15px;
  }
  #buttonsWrapper {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }
  .channel-btn {
    cursor: pointer;
    display: flex;
    align-items: center;
    background: rgba(0,0,0,0.5);
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 16px;
    user-select: none;
    color: white;
    transition: background 0.3s;
  }
  .channel-btn:hover {
    background: rgba(255, 255, 255, 0.2);
  }
  .channel-btn img {
    height: 24px;
    width: auto;
    margin-right: 8px;
    display: block;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(8, 60px);
    grid-template-rows: repeat(8, 60px);
    gap: 5px;
    margin-bottom: 15px;
  }
  .cell {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255,255,255,0.5);
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    transition: transform 0.2s, background-color 0.3s;
    user-select: none;
  }
  .cell:hover {
    transform: scale(1.05);
  }
  .cell.opened {
    background-color: rgba(0, 0, 0, 0.6);
    cursor: default;
  }
  .cell.bomb {
    animation: bombFlash 0.5s infinite alternate;
    background: red !important;
  }
  @keyframes bombFlash {
    from { background: red; }
    to { background: darkred; }
  }
  .reward {
    color: #00ff00;
  }
  #upgradeBtn {
    padding: 10px 20px;
    font-size: 18px;
    background: gold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-bottom: 15px;
    user-select: none;
  }
  #upgradeBtn:disabled {
    background: gray;
    cursor: not-allowed;
  }
  #showAllBtn {
    padding: 8px 15px;
    font-size: 16px;
    background: #444;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
    user-select: none;
    margin-bottom: 20px;
  }
  #showAllBtn:disabled {
    background: #222;
    cursor: not-allowed;
  }
  /* Roulette styles */
  #rouletteWrapper {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 220px;
    height: 220px;
    background: rgba(0,0,0,0.7);
    border-radius: 12px;
    padding: 10px;
    box-sizing: border-box;
    user-select: none;
  }
  #rouletteCanvas {
    display: block;
    margin: 0 auto;
    background: #222;
    border-radius: 50%;
  }
  #rouletteArrow {
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 25px solid #00ff00;
    margin: 5px auto 0;
    transform: rotate(180deg);
  }
  #rouletteResult {
    text-align: center;
    margin-top: 10px;
    color: #0f0;
    font-weight: bold;
    font-size: 18px;
    min-height: 24px;
  }
</style>
</head>
<body>

<h1>EXTRIM Miner</h1>

<div id="buttonsWrapper">
  <div id="twitchBtn" class="channel-btn" title="Twitch">
    <img src="https://upload.wikimedia.org/wikipedia/commons/3/38/Twitch_Logo_2019.svg" alt="Twitch" />
    Twitch
  </div>
  <div id="youtubeBtn" class="channel-btn" title="YouTube">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_(2017).svg" alt="YouTube" />
    YouTube
  </div>
</div>

<div class="grid" id="grid"></div>

<button id="upgradeBtn" style="display:none;" disabled>–£–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
<button id="showAllBtn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —è—á–µ–π–∫–∏</button>

<div id="rouletteWrapper" style="display:none;">
  <canvas id="rouletteCanvas" width="200" height="200"></canvas>
  <div id="rouletteArrow"></div>
  <div id="rouletteResult"></div>
</div>

<script>
  const grid = document.getElementById("grid");
  const upgradeBtn = document.getElementById("upgradeBtn");
  const showAllBtn = document.getElementById("showAllBtn");
  const rouletteWrapper = document.getElementById("rouletteWrapper");
  const rouletteCanvas = document.getElementById("rouletteCanvas");
  const rouletteResult = document.getElementById("rouletteResult");
  const ctx = rouletteCanvas.getContext("2d");

  const twitchBtn = document.getElementById("twitchBtn");
  const youtubeBtn = document.getElementById("youtubeBtn");

  // –°—É–º–º—ã –¥–ª—è Twitch (–¥–æ 5000, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
  const twitchRewards = [1000, 1500, 2000, 2500, 5000];
  // –°—É–º–º—ã –¥–ª—è YouTube (–¥–æ 10000)
  const youtubeRewards = [1000, 1500, 2000, 2500, 5000, 10000];

  // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ (—á–µ–º –±–æ–ª—å—à–µ —Å—É–º–º–∞ ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ —à–∞–Ω—Å)
  // –î–ª—è Twitch - —à–∞–Ω—Å—ã –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫: 1000-0.4, 1500-0.3, 2000-0.15, 2500-0.1, 5000-0.05
  // –î–ª—è YouTube ‚Äî –¥–æ–±–∞–≤–∏–º 10000 —Å –º–µ–Ω—å—à–∏–º —à–∞–Ω—Å–æ–º 0.03

  const twitchChances = [0.4, 0.3, 0.15, 0.1, 0.05];
  const youtubeChances = [0.4, 0.3, 0.15, 0.1, 0.05, 0.03];

  let rewards = twitchRewards; // —Å—Ç–∞—Ä—Ç - Twitch
  let chances = twitchChances;

  // –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ - 64 –∫–ª–µ—Ç–∫–∏
  const cellsCount = 64;
  let cellsData = []; // –•—Ä–∞–Ω–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–∏: { type: 'bomb' | 'reward', value: number|null }
  let openedCells = 0;
  let selectedCell = null;
  let gameOver = false;
  let rouletteUsed = false;

  // –°–æ–∑–¥–∞—ë–º –ø–æ–ª–µ 8x8
  function createGrid() {
    grid.innerHTML = '';
    cellsData = [];
    openedCells = 0;
    selectedCell = null;
    gameOver = false;
    rouletteUsed = false;
    upgradeBtn.style.display = 'none';
    upgradeBtn.disabled = true;
    showAllBtn.disabled = true;
    rouletteWrapper.style.display = 'none';
    rouletteResult.textContent = '';

    for(let i = 0; i < cellsCount; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.textContent = '';
      cell.addEventListener('click', () => onCellClick(cell));
      grid.appendChild(cell);
    }

    generateCellsData();
  }

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π 5000 (Twitch) –∏–ª–∏ 10000 (YouTube)
  function generateCellsData() {
    cellsData = [];
    let guaranteedHighRewardIndex = Math.floor(Math.random() * cellsCount);

    for(let i = 0; i < cellsCount; i++) {
      if (i === guaranteedHighRewardIndex) {
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –ø—Ä–∏–∑ –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ
        cellsData.push({ type: 'reward', value: rewards[rewards.length-1] });
      } else {
        // –õ–∏–±–æ –±–æ–º–±–∞ –ª–∏–±–æ –ø—Ä–∏–∑ –ø–æ —à–∞–Ω—Å–∞–º
        const isBomb = Math.random() < 0.2; // 20% –±–æ–º–±—ã
        if(isBomb) {
          cellsData.push({ type: 'bomb', value: null });
        } else {
          cellsData.push({ type: 'reward', value: getRandomRewardByChance() });
        }
      }
    }
  }

  // –í—ã–±–∏—Ä–∞–µ–º —Å—É–º–º—É –ø–æ —à–∞–Ω—Å–∞–º
  function getRandomRewardByChance() {
    let rand = Math.random();
    let cumulative = 0;
    for(let i=0; i<chances.length; i++) {
      cumulative += chances[i];
      if(rand <= cumulative) return rewards[i];
    }
    // –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ
    return rewards[0];
  }

  function onCellClick(cell) {
    if(gameOver) return;
    if(selectedCell) return; // –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —è—á–µ–π–∫—É!
    const index = +cell.dataset.index;
    const data = cellsData[index];
    if(cell.classList.contains('opened')) return;

    cell.classList.add('opened');
    openedCells++;
    selectedCell = cell;
    showAllBtn.disabled = false;

    if(data.type === 'bomb') {
      cell.textContent = 'üí£';
      cell.classList.add('bomb');
      upgradeBtn.style.display = 'none';
      upgradeBtn.disabled = true;
      gameOver = true;
      alert('–í—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –±–æ–º–±—É! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
    } else {
      animateNumber(cell, 0, data.value);
      cell.classList.add('reward');
      upgradeBtn.style.display = 'inline-block';
      upgradeBtn.disabled = false;
    }
  }

  function animateNumber(cell, start, end) {
    let current = start;
    const step = Math.ceil((end - start) / 20);
    const interval = setInterval(() => {
      current += step;
      if(current >= end) {
        current = end;
        clearInterval(interval);
      }
      cell.textContent = current;
    }, 50);
  }

  // –ö–Ω–æ–ø–∫–∞ —É–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
  upgradeBtn.addEventListener('click', () => {
    if(gameOver || !selectedCell) return;
    if(rouletteUsed) {
      alert('–†—É–ª–µ—Ç–∫–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!');
      return;
    }
    rouletteWrapper.style.display = 'block';
    startRoulette(selectedCell);
  });

  // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —è—á–µ–π–∫–∏
  showAllBtn.addEventListener('click', () => {
    if(!selectedCell) return;
    cellsData.forEach((data, i) => {
      const cell = grid.children[i];
      if(cell.classList.contains('opened')) return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—É—é
      cell.classList.add('opened');
      if(data.type === 'bomb') {
        cell.textContent = 'üí£';
        cell.classList.add('bomb');
      } else {
        cell.textContent = data.value;
        cell.classList.add('reward');
      }
    });
    showAllBtn.disabled = true;
  });

  // –†—É–ª–µ—Ç–∫–∞ ‚Äî –ø–ª–∞–≤–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  function startRoulette(cell) {
    rouletteUsed = true;
    upgradeBtn.disabled = true;
    const prizes = ['x2', 'üî•']; // –£–¥–≤–æ–µ–Ω–∏–µ –∏–ª–∏ —Å–≥–æ—Ä–∞–Ω–∏–µ
    const prizeColors = ['#0f0', '#f00'];

    let startAngle = 0;
    let spinTime = 0;
    let spinTimeTotal = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã –≤—Ä–∞—â–µ–Ω–∏—è

    function drawRoulette(angle) {
      const colors = ['#222', '#333'];
      const centerX = rouletteCanvas.width / 2;
      const centerY = rouletteCanvas.height / 2;
      const radius = centerX - 10;
      ctx.clearRect(0, 0, rouletteCanvas.width, rouletteCanvas.height);

      // –°–µ–≥–º–µ–Ω—Ç—ã - 2 –∑–æ–Ω—ã: –∑–µ–ª—ë–Ω–∞—è –∏ –∫—Ä–∞—Å–Ω–∞—è
      const segments = [
        { color: '#0a0', text: 'x2' },
        { color: '#a00', text: 'üî•' },
      ];
      let startAngleSeg = angle;
      for(let i=0; i<segments.length; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.fillStyle = segments[i].color;
        ctx.arc(centerX, centerY, radius, startAngleSeg, startAngleSeg + Math.PI, false);
        ctx.closePath();
        ctx.fill();

        // –¢–µ–∫—Å—Ç —Å–µ–≥–º–µ–Ω—Ç–∞
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngleSeg + Math.PI/2);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(segments[i].text, 0, -radius/2);
        ctx.restore();

        startAngleSeg += Math.PI;
      }

      // –°—Ç—Ä–µ–ª–∫–∞ —Ä–∏—Å—É–µ—Ç—Å—è –≤ html, –Ω–µ –Ω–∞ canvas
    }

    function easeOut(t) {
      return --t * t * t + 1;
    }

    function rotate() {
      spinTime += 30;
      if(spinTime >= spinTimeTotal) {
        finishSpin();
        return;
      }
      const angle = easeOut(spinTime / spinTimeTotal) * 2 * Math.PI * 6; // –∫—Ä—É—Ç–∏—Ç 6 –∫—Ä—É–≥–æ–≤
      drawRoulette(angle);
      requestAnimationFrame(rotate);
    }

    function finishSpin() {
      // –í—ã—á–∏—Å–ª—è–µ–º, –Ω–∞ –∫–∞–∫–æ–π —Å–µ–∫—Ç–æ—Ä —É–ø–∞–ª–∞ —Å—Ç—Ä–µ–ª–∫–∞ (–∫–æ—Ç–æ—Ä–∞—è —Å–≤–µ—Ä—Ö—É, —ç—Ç–æ 180deg)
      // angle –æ—Ç 0 –¥–æ 2PI
      const finalAngle = easeOut(spinTime / spinTimeTotal) * 2 * Math.PI * 6;
      const normalizedAngle = finalAngle % (2 * Math.PI);
      // —Å–µ–∫—Ç–æ—Ä 0 - x2 (–∑–µ–ª–µ–Ω–∞—è), —Å–µ–∫—Ç–æ—Ä 1 - –æ–≥–æ–Ω—å (–∫—Ä–∞—Å–Ω–∞—è)
      // –°—Ç—Ä–µ–ª–∫–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤–Ω–∏–∑ (180deg), —Ç–∞–∫ —á—Ç–æ –≤—ã—á–∏—Å–ª—è–µ–º —Å–¥–≤–∏–≥
      let pointerAngle = (normalizedAngle + Math.PI) % (2 * Math.PI);

      // –µ—Å–ª–∏ pointerAngle –≤ 0..PI => x2, –∏–Ω–∞—á–µ –æ–≥–æ–Ω—å
      let wonDouble = pointerAngle < Math.PI;

      if(wonDouble) {
        // –£–¥–≤–∞–∏–≤–∞–µ–º —Å—É–º–º—É –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ
        let currentVal = parseInt(cell.textContent);
        let newVal = currentVal * 2;
        animateNumber(cell, currentVal, newVal);
        rouletteResult.style.color = '#0f0';
        rouletteResult.textContent = '–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ x2!';
      } else {
        // –°–≥–æ—Ä–∞–µ—Ç —Å—É–º–º–∞ ‚Äî –±–æ–º–±–∞ –≤ —è—á–µ–π–∫–µ –∏ –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
        cell.textContent = 'üí•';
        cell.classList.remove('reward');
        cell.classList.add('bomb');
        rouletteResult.style.color = '#f00';
        rouletteResult.textContent = '–°—É–º–º–∞ —Å–≥–æ—Ä–µ–ª–∞! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.';
        gameOver = true;
      }
    }

    // –ù–∞—á–∏–Ω–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
    spinTime = 0;
    rotate();
  }

  // –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–∞–Ω–∞–ª–∞
  twitchBtn.addEventListener('click', () => {
    if(gameOver) return;
    rewards = twitchRewards;
    chances = twitchChances;
    createGrid();
  });
  youtubeBtn.addEventListener('click', () => {
    if(gameOver) return;
    rewards = youtubeRewards;
    chances = youtubeChances;
    createGrid();
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  createGrid();
</script>

</body>
</html>
