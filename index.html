<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner —Å —Ä—É–ª–µ—Ç–∫–æ–π</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: url('extrim.png') no-repeat center center fixed;
    background-size: cover;
    position: relative;
    color: #fff;
  }
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 0;
  }
  h1 {
    margin: 20px 0 10px 0;
    font-weight: 700;
    font-size: 2.5rem;
    position: relative;
    z-index: 1;
    text-shadow: 0 0 10px rgba(0,0,0,0.7);
  }
  .button-container {
    margin-bottom: 20px;
    position: relative;
    z-index: 1;
  }
  .source-btn {
    font-size: 16px;
    font-weight: 600;
    padding: 10px 25px;
    margin: 0 8px;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    background-color: rgba(255, 215, 0, 0.8);
    color: #000;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.6);
    transition: background-color 0.3s, transform 0.2s;
    user-select: none;
  }
  .source-btn:hover {
    background-color: gold;
    transform: scale(1.05);
  }
  .source-btn.active {
    background-color: #ffd700;
    box-shadow: 0 0 20px gold;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(8, 70px);
    grid-template-rows: repeat(8, 70px);
    gap: 8px;
    background: rgba(0, 0, 0, 0.45);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    position: relative;
    z-index: 1;
  }
  .cell {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    border: 2px solid #222;
    box-shadow: 0 3px 5px rgba(0,0,0,0.2);
    font-size: 20px;
    font-weight: 700;
    color: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    transition: transform 0.2s, background-color 0.3s;
  }
  .cell:hover {
    background: #fff;
    transform: scale(1.08);
  }
  .cell[data-clicked="true"] {
    cursor: default;
    transform: none;
    background: #eee;
    color: #333;
  }
  .bomb {
    animation: bombFlash 0.6s infinite alternate;
    background: #c62828 !important;
    color: white !important;
    font-size: 26px;
    box-shadow: 0 0 15px #ff3d3d;
  }
  @keyframes bombFlash {
    0% { background: #c62828; }
    100% { background: #b71c1c; }
  }
  .reward {
    color: #2e7d32;
    text-shadow: 0 0 6px #4caf50;
  }
  #upgradeBtn {
    margin-top: 25px;
    padding: 14px 40px;
    font-size: 20px;
    font-weight: 700;
    border: none;
    border-radius: 40px;
    background: linear-gradient(45deg, #ffd700, #ffab00);
    color: #000;
    cursor: pointer;
    box-shadow: 0 0 25px #ffea00;
    user-select: none;
    transition: background-color 0.3s, transform 0.2s;
    position: relative;
    z-index: 1;
  }
  #upgradeBtn:hover {
    background: linear-gradient(45deg, #ffea00, #ffc107);
    transform: scale(1.05);
  }
  #upgradeBtn:active {
    transform: scale(0.95);
  }
  /* –†—É–ª–µ—Ç–∫–∞ (–æ–≤–µ—Ä–ª–µ–π) */
  #rouletteOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    flex-direction: column;
    user-select: none;
    display: none;
  }
  #rouletteContainer {
    position: relative;
    width: 300px;
    height: 300px;
  }
  #rouletteCanvas {
    border-radius: 50%;
    box-shadow: 0 0 20px #ffea00;
    background: #222;
  }
  #arrow {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 30px solid #ffd700;
    filter: drop-shadow(0 0 3px #fff);
  }
  #closeBtn {
    margin-top: 20px;
    padding: 10px 25px;
    font-size: 18px;
    font-weight: 700;
    border: none;
    border-radius: 30px;
    background: gold;
    color: #000;
    cursor: pointer;
    box-shadow: 0 0 10px #ffea00;
    user-select: none;
  }
  #resultText {
    margin-top: 15px;
    font-size: 24px;
    font-weight: 700;
    color: #0f0;
    text-shadow: 0 0 10px #0f0;
  }
  #resultText.fail {
    color: #f00;
    text-shadow: 0 0 10px #f00;
  }
</style>
</head>
<body>

<h1>EXTRIM Miner</h1>

<div class="button-container">
  <button id="btnTwitch" class="source-btn active">Twitch</button>
  <button id="btnYouTube" class="source-btn">YouTube</button>
</div>

<div class="grid" id="grid"></div>
<button id="upgradeBtn" style="display:none;">–£–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>

<!-- –†—É–ª–µ—Ç–∫–∞ -->
<div id="rouletteOverlay">
  <div id="rouletteContainer">
    <canvas id="rouletteCanvas" width="300" height="300"></canvas>
    <div id="arrow"></div>
  </div>
  <div id="resultText"></div>
  <button id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
  const grid = document.getElementById("grid");
  const upgradeBtn = document.getElementById("upgradeBtn");
  const btnTwitch = document.getElementById("btnTwitch");
  const btnYouTube = document.getElementById("btnYouTube");

  const rouletteOverlay = document.getElementById('rouletteOverlay');
  const rouletteCanvas = document.getElementById('rouletteCanvas');
  const ctx = rouletteCanvas.getContext('2d');
  const resultText = document.getElementById('resultText');
  const closeBtn = document.getElementById('closeBtn');

  let currentRewardCell = null;
  let currentSource = 'twitch';
  let currentRewardValue = 0;

  const twitchRewards = [
    {value: 1000, weight: 40},
    {value: 1500, weight: 30},
    {value: 2000, weight: 15},
    {value: 2500, weight: 8},
    {value: 5000, weight: 5},
  ];

  const youtubeRewards = [
    {value: 1000, weight: 35},
    {value: 1500, weight: 25},
    {value: 2000, weight: 15},
    {value: 2500, weight: 10},
    {value: 5000, weight: 8},
    {value: 10000, weight: 7},
  ];

  function weightedRandom(items) {
    let total = items.reduce((sum, item) => sum + item.weight, 0);
    let rand = Math.random() * total;
    for (let item of items) {
      if (rand < item.weight) return item.value;
      rand -= item.weight;
    }
  }

  function createGrid() {
    grid.innerHTML = '';
    for (let i = 0; i < 64; i++) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.dataset.clicked = "false";
      cell.addEventListener("click", () => handleClick(cell));
      grid.appendChild(cell);
    }
  }

  function handleClick(cell) {
    if (cell.dataset.clicked === "true") return;

    cell.dataset.clicked = "true";

    // 20% —à–∞–Ω—Å –±–æ–º–±—ã
    if (Math.random() < 0.2) {
      cell.textContent = "üí£";
      cell.classList.add("bomb");
      upgradeBtn.style.display = "none";
      currentRewardCell = null;
      currentRewardValue = 0;
      return;
    }

    let rewardsList = currentSource === 'twitch' ? twitchRewards : youtubeRewards;
    let finalValue = weightedRandom(rewardsList);
    currentRewardValue = finalValue;
    animateNumber(cell, finalValue);
    cell.classList.add("reward");
    currentRewardCell = cell;
    upgradeBtn.style.display = "block";
  }

  function animateNumber(cell, target) {
    let value = 0;
    let step = Math.ceil(target / 20);
    let interval = setInterval(() => {
      value += step;
      if (value >= target) {
        value = target;
        clearInterval(interval);
      }
      cell.textContent = value;
    }, 50);
  }

  upgradeBtn.addEventListener("click", () => {
    if (!currentRewardCell) return;

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
    startRoulette();
  });

  btnTwitch.addEventListener("click", () => {
    currentSource = 'twitch';
    btnTwitch.classList.add('active');
    btnYouTube.classList.remove('active');
    resetGrid();
  });

  btnYouTube.addEventListener("click", () => {
    currentSource = 'youtube';
    btnYouTube.classList.add('active');
    btnTwitch.classList.remove('active');
    resetGrid();
  });

  function resetGrid() {
    upgradeBtn.style.display = "none";
    currentRewardCell = null;
    currentRewardValue = 0;
    createGrid();
  }

  // --- –†—É–ª–µ—Ç–∫–∞ ---

  // –û–ø—Ä–µ–¥–µ–ª–∏–º –∑–æ–Ω—ã –Ω–∞ —Ä—É–ª–µ—Ç–∫–µ (–≤ –≥—Ä–∞–¥—É—Å–∞—Ö)
  // –ü—É—Å—Ç—å –∫—Ä—É–≥ 360¬∞, –≥–¥–µ –∑–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ ‚Äî 120¬∞ (1/3 –∫—Ä—É–≥–∞), –∫—Ä–∞—Å–Ω–∞—è ‚Äî 240¬∞
  // –ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞: –æ—Ç 0¬∞ –¥–æ 120¬∞, –∫—Ä–∞—Å–Ω–∞—è: 120¬∞ –¥–æ 360¬∞
  // –°—Ç—Ä–µ–ª–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –≤–≤–µ—Ä—Ö (0¬∞)

  let startAngle = 0;
  let spinTimeout = null;
  let spinAngleStart = 0;
  let spinTime = 0;
  let spinTimeTotal = 0;

  function drawRoulette() {
    const radius = 150;
    const centerX = rouletteCanvas.width / 2;
    const centerY = rouletteCanvas.height / 2;

    ctx.clearRect(0, 0, rouletteCanvas.width, rouletteCanvas.height);

    // –ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ (120¬∞)
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, degToRad(startAngle), degToRad(startAngle + 120));
    ctx.closePath();
    ctx.fillStyle = '#4caf50'; // –∑–µ–ª–µ–Ω—ã–π
    ctx.fill();

    // –ö—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ (240¬∞)
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, degToRad(startAngle + 120), degToRad(startAngle + 360));
    ctx.closePath();
    ctx.fillStyle = '#f44336'; // –∫—Ä–∞—Å–Ω—ã–π
    ctx.fill();

    // –ö—Ä—É–≥–ª–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.lineWidth = 4;
    ctx.strokeStyle = '#ffd700';
    ctx.stroke();
  }

  function degToRad(deg) {
    return (deg * Math.PI) / 180;
  }

  function rotateRoulette() {
    spinTime += 30;
    if (spinTime >= spinTimeTotal) {
      stopRotateWheel();
      return;
    }
    let spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
    startAngle = (startAngle + spinAngle) % 360;
    drawRouletteRotated(startAngle);
    spinTimeout = setTimeout(rotateRoulette, 30);
  }

  function drawRouletteRotated(angle) {
    const radius = 150;
    const centerX = rouletteCanvas.width / 2;
    const centerY = rouletteCanvas.height / 2;

    ctx.clearRect(0, 0, rouletteCanvas.width, rouletteCanvas.height);
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(degToRad(angle));
    ctx.translate(-centerX, -centerY);

    // –ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ (120¬∞)
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, degToRad(0), degToRad(120));
    ctx.closePath();
    ctx.fillStyle = '#4caf50';
    ctx.fill();

    // –ö—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ (240¬∞)
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, degToRad(120), degToRad(360));
    ctx.closePath();
    ctx.fillStyle = '#f44336';
    ctx.fill();

    // –ö—Ä—É–≥–ª–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.lineWidth = 4;
    ctx.strokeStyle = '#ffd700';
    ctx.stroke();

    ctx.restore();
  }

  function easeOut(t, b, c, d) {
    const ts = (t /= d) * t;
    const tc = ts * t;
    return b + c * (tc + -3 * ts + 3 * t);
  }

  function startRoulette() {
    resultText.textContent = '';
    rouletteOverlay.style.display = 'flex';
    spinAngleStart = Math.floor(Math.random() * 360) + 720; // –º–∏–Ω–∏–º—É–º 2 –æ–±–æ—Ä–æ—Ç–∞ + —Ä–∞–Ω–¥–æ–º
    spinTime = 0;
    spinTimeTotal = 4000; // 4 —Å–µ–∫—É–Ω–¥—ã –∫—Ä—É—á–µ–Ω–∏—è
    rotateRoulette();
  }

  function stopRotateWheel() {
    clearTimeout(spinTimeout);
    // –†–∞—Å—Å—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π —É–≥–æ–ª –ø–æ —Å—Ç—Ä–µ–ª–∫–µ (0¬∞ - —Å–≤–µ—Ä—Ö—É)
    let degrees = (startAngle % 360);
    // –ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ 0-120, –∫—Ä–∞—Å–Ω–∞—è 120-360
    if (degrees <= 120) {
      // –ü–æ–±–µ–¥–∞ ‚Äî —Ö2
      currentRewardValue *= 2;
      animateNumber(currentRewardCell, currentRewardValue);
      resultText.textContent = `–£–¥–∞—á–∞! –ù–∞–≥—Ä–∞–¥–∞ —É–º–Ω–æ–∂–µ–Ω–∞ –Ω–∞ 2: ${currentRewardValue}`;
      resultText.classList.remove('fail');
    } else {
      // –ü—Ä–æ–∏–≥—Ä—ã—à ‚Äî —Å–≥–æ—Ä–∞–µ—Ç
      currentRewardValue = 0;
      currentRewardCell.textContent = '0';
      resultText.textContent = '–£–≤—ã, –Ω–∞–≥—Ä–∞–¥–∞ —Å–≥–æ—Ä–µ–ª–∞!';
      resultText.classList.add('fail');
    }
  }

  closeBtn.addEventListener('click', () => {
    rouletteOverlay.style.display = 'none';
    upgradeBtn.style.display = currentRewardValue > 0 ? 'block' : 'none';

    if(currentRewardValue === 0) {
      // –û–±–Ω—É–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã
      currentRewardCell.dataset.clicked = "false";
      currentRewardCell.classList.remove('reward');
      currentRewardCell.textContent = '';
      currentRewardCell = null;
    }
  });

  createGrid();

  btnTwitch.addEventListener("click", () => {
    currentSource = 'twitch';
    btnTwitch.classList.add('active');
    btnYouTube.classList.remove('active');
    resetGrid();
  });

  btnYouTube.addEventListener("click", () => {
    currentSource = 'youtube';
    btnYouTube.classList.add('active');
    btnTwitch.classList.remove('active');
    resetGrid();
  });

  function resetGrid() {
    upgradeBtn.style.display = "
