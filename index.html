<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner</title>
<style>
  /* —Ç–≤–æ–π CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
</style>
</head>
<body>

<div id="container">
  <div id="leftSide">
    <h1>EXTRIM Miner</h1>

    <div id="buttonsWrapper">
      <div id="twitchBtn" class="channel-btn active">
        <img src="https://cdn.discordapp.com/attachments/1374833926157107230/1404918424618143866/twitch_logo_icon_189242.png" alt="Twitch" />
        Twitch
      </div>
      <div id="youtubeBtn" class="channel-btn">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/42/YouTube_icon_%282013-2017%29.png" alt="YouTube" />
        YouTube
      </div>
    </div>

    <div id="grid"></div>

    <div>
      <button id="rouletteBtn" disabled>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É</button>
      <button id="showAllBtn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —è—á–µ–π–∫–∏</button>
    </div>

    <div id="resultMessage"></div>
  </div>

  <div id="rouletteWrapper">
    <div id="rouletteWheel">
      <div id="labelCombined"><span class="red">–°–≥–æ—Ä–µ–ª–æ</span> | <span class="green">x2</span></div>
    </div>
    <div id="arrow" title="–°—Ç—Ä–µ–ª–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ (–Ω–∞–≤–µ–¥–µ–Ω–∏–µ)"></div>
  </div>
</div>

<script>
  const grid = document.getElementById('grid');
  const twitchBtn = document.getElementById('twitchBtn');
  const youtubeBtn = document.getElementById('youtubeBtn');
  const rouletteBtn = document.getElementById('rouletteBtn');
  const showAllBtn = document.getElementById('showAllBtn');
  const rouletteWheel = document.getElementById('rouletteWheel');
  const resultMessage = document.getElementById('resultMessage');

  const twitchRewards = [1000, 1500, 2000, 2500, 5000];
  const youtubeRewards = [1000, 1500, 2000, 2500, 5000, 10000];

  const twitchChances = [0.4, 0.3, 0.15, 0.1, 0.05];
  const youtubeChances = [0.4, 0.3, 0.15, 0.1, 0.05, 0.03];

  let rewards = twitchRewards;
  let chances = twitchChances;

  const cellsCount = 64;
  let cellsData = [];
  let selectedCellIndex = null;
  let gameOver = false;
  let rouletteSpinning = false;

  function createGrid() {
    grid.innerHTML = '';
    cellsData = [];
    selectedCellIndex = null;
    gameOver = false;
    rouletteSpinning = false;
    rouletteBtn.disabled = true;
    showAllBtn.disabled = true;
    resultMessage.textContent = '';

    twitchBtn.classList.remove('disabled');
    youtubeBtn.classList.remove('disabled');

    for (let i = 0; i < cellsCount; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.addEventListener('click', onCellClick);
      grid.appendChild(cell);
    }

    generateCellsData();
  }

  function generateCellsData() {
    cellsData = [];
    const guaranteedIndex = Math.floor(Math.random() * cellsCount);

    for (let i = 0; i < cellsCount; i++) {
      if (i === guaranteedIndex) {
        cellsData.push({ type: 'reward', value: rewards[rewards.length - 1] });
      } else {
        const bombChance = 0.2;
        if (Math.random() < bombChance) {
          cellsData.push({ type: 'bomb' });
        } else {
          cellsData.push({ type: 'reward', value: getRandomReward() });
        }
      }
    }
  }

  function getRandomReward() {
    let r = Math.random();
    let sum = 0;
    for (let i = 0; i < chances.length; i++) {
      sum += chances[i];
      if (r <= sum) return rewards[i];
    }
    return rewards[0];
  }

  function onCellClick(e) {
    if (gameOver || rouletteSpinning) return;
    if (selectedCellIndex !== null) return;

    const cell = e.currentTarget;
    const index = +cell.dataset.index;
    if (cell.classList.contains('opened')) return;

    cell.classList.add('opened');
    selectedCellIndex = index;
    showAllBtn.disabled = false;

    const data = cellsData[index];
    if (data.type === 'bomb') {
      cell.textContent = 'üí£';
      cell.classList.add('bomb');
      gameOver = true;
      rouletteBtn.disabled = true;
      twitchBtn.classList.add('disabled');
      youtubeBtn.classList.add('disabled');
      twitchBtn.classList.remove('active');
      youtubeBtn.classList.remove('active');
      resultMessage.textContent = '–í–∑–æ—Ä–≤–∞–ª–∞—Å—å –±–æ–º–±–∞! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.';
    } else {
      cell.textContent = data.value;
      rouletteBtn.disabled = false;
      resultMessage.textContent = '';
    }
  }

  twitchBtn.addEventListener('click', () => {
    if (gameOver || rouletteSpinning) return;
    if (selectedCellIndex !== null) return;
    rewards = twitchRewards;
    chances = twitchChances;
    twitchBtn.classList.add('active');
    youtubeBtn.classList.remove('active');
    createGrid();
  });

  youtubeBtn.addEventListener('click', () => {
    if (gameOver || rouletteSpinning) return;
    if (selectedCellIndex !== null) return;
    rewards = youtubeRewards;
    chances = youtubeChances;
    youtubeBtn.classList.add('active');
    twitchBtn.classList.remove('active');
    createGrid();
  });

  // –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä—É–ª–µ—Ç–∫–∞
  rouletteBtn.addEventListener('click', () => {
    if (rouletteSpinning || selectedCellIndex === null) return;

    rouletteSpinning = true;
    rouletteBtn.disabled = true;
    twitchBtn.classList.add('disabled');
    youtubeBtn.classList.add('disabled');

    resultMessage.textContent = '–†—É–ª–µ—Ç–∫–∞ –∫—Ä—É—Ç–∏—Ç—Å—è...';

    const winningHalf = Math.random() < 0.5 ? 0 : 1; // 0 - –∑–µ–ª—ë–Ω–∞—è (x2), 1 - –∫—Ä–∞—Å–Ω–∞—è (—Å–≥–æ—Ä–µ–ª–æ)
    const spins = 3 + Math.random() * 3;

    // —Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ 90¬∞, —Ç–∞–∫ –∫–∞–∫ —Å—Ç—Ä–µ–ª–∫–∞ —Å–ø—Ä–∞–≤–∞
    const baseAngle = Math.random() * 180;
    const offset = 90;
    const stopAngle = 360 * spins + offset + (winningHalf === 0 ? baseAngle : 180 + baseAngle);

    rouletteWheel.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
    rouletteWheel.style.transform = `rotate(${stopAngle}deg)`;

    setTimeout(() => {
      rouletteSpinning = false;
      if (winningHalf === 0) {
        const cell = grid.children[selectedCellIndex];
        let currentValue = parseInt(cell.textContent) || 0;
        let newValue = currentValue * 2;
        cell.textContent = newValue;
        resultMessage.innerHTML = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ù–∞–≥—Ä–∞–¥–∞ —É–¥–≤–æ–µ–Ω–∞: <span style="color:#0f0;">${newValue}</span>`;
      } else {
        const cell = grid.children[selectedCellIndex];
        cell.textContent = 'üíî';
        cell.classList.add('bomb');
        resultMessage.innerHTML = `<span style="color:#f00;">–°—É–º–º–∞ —Å–≥–æ—Ä–µ–ª–∞! üò¢</span>`;
        gameOver = true;
      }
    }, 5200);
  });

  showAllBtn.addEventListener('click', () => {
    for (let i = 0; i < cellsCount; i++) {
      const cell = grid.children[i];
      if (cell.classList.contains('opened')) continue;
      const data = cellsData[i];
      cell.classList.add('opened');
      if (data.type === 'bomb') {
        cell.textContent = 'üí£';
        cell.classList.add('bomb');
      } else {
        cell.textContent = data.value;
      }
    }
    showAllBtn.disabled = true;
  });

  createGrid();
</script>

</body>
</html>
