<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('extrim.png') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    color: white;
    padding: 20px;
  }
  h1 {
    background: rgba(0,0,0,0.5);
    padding: 10px 20px;
    border-radius: 10px;
    margin-bottom: 15px;
  }
  #buttonsWrapper {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }
  .channel-btn {
    cursor: pointer;
    display: flex;
    align-items: center;
    background: rgba(0,0,0,0.5);
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 16px;
    user-select: none;
    color: white;
    transition: background 0.3s;
  }
  .channel-btn:hover {
    background: rgba(255, 255, 255, 0.2);
  }
  .channel-btn img {
    height: 24px;
    width: auto;
    margin-right: 8px;
    display: block;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(8, 60px);
    grid-template-rows: repeat(8, 60px);
    gap: 5px;
    margin-bottom: 15px;
  }
  .cell {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255,255,255,0.5);
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    transition: transform 0.2s, background-color 0.3s;
    user-select: none;
  }
  .cell:hover {
    transform: scale(1.05);
  }
  .cell.opened {
    background-color: rgba(0, 0, 0, 0.6);
    cursor: default;
  }
  .cell.bomb {
    animation: bombFlash 0.5s infinite alternate;
    background: red !important;
  }
  @keyframes bombFlash {
    from { background: red; }
    to { background: darkred; }
  }
  .reward {
    color: #00ff00;
  }
  #rouletteBtn {
    padding: 10px 20px;
    font-size: 18px;
    background: gold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-bottom: 15px;
    user-select: none;
    width: 200px;
  }
  #rouletteBtn:disabled {
    background: gray;
    cursor: not-allowed;
    position: relative;
  }
  #rouletteBtn:disabled::after {
    content: ' üîí';
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 20px;
  }
  #showAllBtn {
    padding: 8px 15px;
    font-size: 16px;
    background: #444;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
    user-select: none;
    margin-bottom: 20px;
    width: 200px;
  }
  #showAllBtn:disabled {
    background: #222;
    cursor: not-allowed;
  }
  /* Roulette styles */
  #rouletteWrapper {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 220px;
    height: 270px;
    background: rgba(0,0,0,0.7);
    border-radius: 12px;
    padding: 10px;
    box-sizing: border-box;
    user-select: none;
    display: none;
    z-index: 1000;
  }
  #rouletteCanvas {
    display: block;
    margin: 0 auto;
    background: #222;
    border-radius: 50%;
  }
  #rouletteArrow {
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 25px solid #00ff00;
    margin: 0 auto 10px;
  }
  #rouletteResult {
    text-align: center;
    color: #0f0;
    font-weight: bold;
    font-size: 18px;
    min-height: 24px;
  }
</style>
</head>
<body>

<h1>EXTRIM Miner</h1>

<div id="buttonsWrapper">
  <div id="twitchBtn" class="channel-btn" title="Twitch">
    <img src="https://cdn-icons-png.flaticon.com/512/733/733635.png" alt="Twitch" />
    Twitch
  </div>
  <div id="youtubeBtn" class="channel-btn" title="YouTube">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_(2017).svg" alt="YouTube" />
    YouTube
  </div>
</div>

<div class="grid" id="grid"></div>

<button id="rouletteBtn" disabled>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É</button>
<button id="showAllBtn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —è—á–µ–π–∫–∏</button>

<div id="rouletteWrapper">
  <div id="rouletteArrow"></div>
  <canvas id="rouletteCanvas" width="200" height="200"></canvas>
  <div id="rouletteResult"></div>
</div>

<script>
  const grid = document.getElementById("grid");
  const rouletteBtn = document.getElementById("rouletteBtn");
  const showAllBtn = document.getElementById("showAllBtn");
  const rouletteWrapper = document.getElementById("rouletteWrapper");
  const rouletteCanvas = document.getElementById("rouletteCanvas");
  const rouletteResult = document.getElementById("rouletteResult");
  const ctx = rouletteCanvas.getContext("2d");

  const twitchBtn = document.getElementById("twitchBtn");
  const youtubeBtn = document.getElementById("youtubeBtn");

  const twitchRewards = [1000, 1500, 2000, 2500, 5000];
  const youtubeRewards = [1000, 1500, 2000, 2500, 5000, 10000];

  const twitchChances = [0.4, 0.3, 0.15, 0.1, 0.05];
  const youtubeChances = [0.4, 0.3, 0.15, 0.1, 0.05, 0.03];

  let rewards = twitchRewards;
  let chances = twitchChances;

  const cellsCount = 64;
  let cellsData = [];
  let openedCells = 0;
  let selectedCellIndex = null;
  let gameOver = false;
  let rouletteUsed = false;

  function createGrid() {
    grid.innerHTML = '';
    cellsData = [];
    openedCells = 0;
    selectedCellIndex = null;
    gameOver = false;
    rouletteUsed = false;
    rouletteBtn.disabled = true;
    rouletteBtn.style.display = 'inline-block';
    rouletteWrapper.style.display = 'none';
    rouletteResult.textContent = '';
    showAllBtn.disabled = true;

    for(let i = 0; i < cellsCount; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.textContent = '';
      cell.addEventListener('click', () => onCellClick(cell));
      grid.appendChild(cell);
    }

    generateCellsData();
  }

  function generateCellsData() {
    cellsData = [];
    let guaranteedHighRewardIndex = Math.floor(Math.random() * cellsCount);

    for(let i = 0; i < cellsCount; i++) {
      if (i === guaranteedHighRewardIndex) {
        cellsData.push({ type: 'reward', value: rewards[rewards.length-1] });
      } else {
        const isBomb = Math.random() < 0.2;
        if(isBomb) {
          cellsData.push({ type: 'bomb', value: null });
        } else {
          cellsData.push({ type: 'reward', value: getRandomRewardByChance() });
        }
      }
    }
  }

  function getRandomRewardByChance() {
    let rand = Math.random();
    let cumulative = 0;
    for(let i=0; i<chances.length; i++) {
      cumulative += chances[i];
      if(rand <= cumulative) return rewards[i];
    }
    return rewards[0];
  }

  function onCellClick(cell) {
    if(gameOver) return;
    if(selectedCellIndex !== null) return; // –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —è—á–µ–π–∫—É
    const index = +cell.dataset.index;
    if(cell.classList.contains('opened')) return;

    cell.classList.add('opened');
    openedCells++;
    selectedCellIndex = index;
    showAllBtn.disabled = false;
    rouletteBtn.disabled = false;

    const data = cellsData[index];
    if(data.type === 'bomb') {
      cell.textContent = 'üí£';
      cell.classList.add('bomb');
      rouletteBtn.disabled = true; // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä—É–ª–µ—Ç–∫—É –ø—Ä–∏ –±–æ–º–±–µ
      gameOver = true;
      alert('–í—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –±–æ–º–±—É! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
    } else {
      animateNumber(cell, 0, data.value);
      cell.classList.add('reward');
    }
  }

  function animateNumber(cell, start, end) {
    let current = start;
    const step = Math.ceil((end - start) / 20);
    const interval = setInterval(() => {
      current += step;
      if(current >= end) {
        current = end;
        clearInterval(interval);
      }
      cell.textContent = current;
    }, 50);
  }

  rouletteBtn.addEventListener('click', () => {
    if(gameOver || rouletteUsed) return;
    if(selectedCellIndex === null) return;
    rouletteWrapper.style.display = 'block';
    startRoulette(grid.children[selectedCellIndex]);
  });

  showAllBtn.addEventListener('click', () => {
    if(selectedCellIndex === null) return;
    cellsData.forEach((data, i) => {
      const cell = grid.children[i];
      if(cell.classList.contains('opened')) return;
      cell.classList.add('opened');
      if(data.type === 'bomb') {
        cell.textContent = 'üí£';
        cell.classList.add('bomb');
      } else {
        cell.textContent = data.value;
        cell.classList.add('reward');
      }
    });
    showAllBtn.disabled = true;
  });

  function startRoulette(cell) {
    rouletteUsed = true;
    rouletteBtn.disabled = true;

    const segments = [
      { color: '#0a0', text: 'x2' },
      { color: '#a00', text: 'üî•' },
    ];

    let spinTime = 0;
    const spinTimeTotal = 3000;

    function drawRoulette(angle) {
      const centerX = rouletteCanvas.width / 2;
      const centerY = rouletteCanvas.height / 2;
      const radius = centerX - 10;
      ctx.clearRect(0, 0, rouletteCanvas.width, rouletteCanvas.height);

      let startAngleSeg = angle;
      for(let i=0; i<segments.length; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.fillStyle = segments[i].color;
        ctx.arc(centerX, centerY, radius, startAngleSeg, startAngleSeg + Math.PI, false);
        ctx.closePath();
        ctx.fill();

        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngleSeg + Math.PI/2);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(segments[i].text, 0, -radius/2);
        ctx.restore();

        startAngleSeg += Math.PI;
      }
    }

    function easeOut(t) {
      return --t * t * t + 1;
    }

    function rotate() {
      spinTime += 30;
      if(spinTime >= spinTimeTotal) {
        finishSpin();
        return;
      }
      const angle = easeOut(spinTime / spinTimeTotal) * 2 * Math.PI * 6;
      drawRoulette(angle);
      requestAnimationFrame(rotate);
    }

    function finishSpin() {
      const finalAngle = easeOut(spinTime / spinTimeTotal) * 2 * Math.PI * 6;
      const normalizedAngle = finalAngle % (2 * Math.PI);
      let pointerAngle = (normalizedAngle + Math.PI) % (2 * Math.PI);

      let wonDouble = pointerAngle < Math.PI;

      if(wonDouble) {
        let currentVal = parseInt(cell.textContent);
        let newVal = currentVal * 2;
        animateNumber(cell, currentVal, newVal);
        rouletteResult.textContent = '–£–º–Ω–æ–∂–µ–Ω–æ –Ω–∞ 2! üéâ';
      } else {
        cell.textContent = '0';
        cell.classList.remove('reward');
        cell.classList.add('bomb');
        rouletteResult.textContent = '–°–≥–æ—Ä–µ–ª–æ! üí•';
        gameOver = true;
      }
    }

    rotate();
  }

  // –°–º–µ–Ω–∞ –∫–∞–Ω–∞–ª–æ–≤
  twitchBtn.addEventListener('click', () => {
    if(gameOver || rouletteUsed) return;
    rewards = twitchRewards;
    chances = twitchChances;
    createGrid();
  });

  youtubeBtn.addEventListener('click', () => {
    if(gameOver || rouletteUsed) return;
    rewards = youtubeRewards;
    chances = youtubeChances;
    createGrid();
  });

  createGrid();
</script>

</body>
</html>
