<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner - –ò–≥—Ä–∞ —Å —è—á–µ–π–∫–∞–º–∏</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('extrim.png') no-repeat center center fixed;
    background-size: cover;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }
  h1 {
    background: rgba(0,0,0,0.5);
    padding: 10px 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(8, 60px);
    grid-template-rows: repeat(8, 60px);
    gap: 6px;
  }
  .cell {
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.5);
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    transition: background-color 0.3s, transform 0.2s;
    color: white;
  }
  .cell:hover:not(.opened) {
    background-color: rgba(255,255,255,0.35);
    transform: scale(1.05);
  }
  .opened {
    cursor: default;
    background-color: rgba(0,0,0,0.7);
  }
  .selected {
    background-color: rgba(255,0,0,0.7);
  }
  .bomb {
    animation: bombFlash 0.6s infinite alternate;
  }
  @keyframes bombFlash {
    from { background-color: rgba(255, 0, 0, 0.7); }
    to { background-color: rgba(150, 0, 0, 0.9); }
  }
  #showAllBtn, #upgradeBtn {
    margin-top: 20px;
    padding: 12px 25px;
    font-size: 18px;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    background: gold;
    color: black;
    user-select: none;
  }
  #upgradeBtn {
    background: #4caf50;
    margin-left: 10px;
  }
  #controls {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  /* –†—É–ª–µ—Ç–∫–∞ */
  #rouletteContainer {
    margin-top: 30px;
    width: 300px;
    height: 300px;
    position: relative;
  }
  #roulette {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 6px solid gold;
    position: relative;
    overflow: hidden;
  }
  #arrow {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid red;
    z-index: 10;
  }
</style>
</head>
<body>

<h1>EXTRIM Miner</h1>

<div id="grid"></div>

<div id="controls" style="display:none;">
  <button id="showAllBtn">–ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —è—á–µ–π–∫–∏</button>
  <button id="upgradeBtn">–£–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
</div>

<div id="rouletteContainer" style="display:none;">
  <div id="arrow"></div>
  <canvas id="roulette" width="300" height="300"></canvas>
</div>

<script>
  const grid = document.getElementById('grid');
  const showAllBtn = document.getElementById('showAllBtn');
  const upgradeBtn = document.getElementById('upgradeBtn');
  const controls = document.getElementById('controls');
  const rouletteContainer = document.getElementById('rouletteContainer');
  const rouletteCanvas = document.getElementById('roulette');
  const ctx = rouletteCanvas.getContext('2d');

  const ROWS = 8;
  const COLS = 8;
  const TOTAL_CELLS = ROWS * COLS;

  // –°—É–º–º—ã Twitch –∏ YouTube
  // Twitch: 1000, 1500, 2000, 2500, 5000 (–∫—Ä—É–≥–ª—ã–µ, –º–µ–Ω—å—à–µ —à–∞–Ω—Å –Ω–∞ –±–æ–ª—å—à–∏–µ)
  // YouTube: –¥–æ–±–∞–≤–ª—è–µ–º 10000

  // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ (—á–µ–º –±–æ–ª—å—à–µ —Å—É–º–º–∞ - —Ç–µ–º –º–µ–Ω—å—à–µ —à–∞–Ω—Å)
  // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Å–∞: –Ω–∞–ø—Ä–∏–º–µ—Ä
  // 1000 - 30%
  // 1500 - 25%
  // 2000 - 20%
  // 2500 - 15%
  // 5000 - 8%
  // 10000 - 2%

  // –ù–æ 10000 —Ç–æ–ª—å–∫–æ –¥–ª—è YouTube, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–ª—è Twitch

  // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Å–æ–∑–¥–∞–¥–∏–º –º–∞—Å—Å–∏–≤ —Å –≤–µ—Å–∞–º–∏ –¥–ª—è Twitch
  const twitchValues = [
    {value: 1000, weight: 30},
    {value: 1500, weight: 25},
    {value: 2000, weight: 20},
    {value: 2500, weight: 15},
    {value: 5000, weight: 8},
  ];

  const youtubeValues = [
    {value: 1000, weight: 30},
    {value: 1500, weight: 25},
    {value: 2000, weight: 20},
    {value: 2500, weight: 15},
    {value: 5000, weight: 8},
    {value: 10000, weight: 2},
  ];

  // –ù–∞—á–∏–Ω–∞–µ–º —Å Twitch –∫–∞–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  let currentSource = 'twitch';

  // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–æ–º–±—ã - 20%
  const bombChance = 0.2;

  // –ú–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ —è—á–µ–π–∫–∞–º, —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  let cellsData = [];

  // –í—ã–±—Ä–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ (–∏–Ω–¥–µ–∫—Å)
  let selectedIndex = null;

  // –¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ
  let currentReward = 0;

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –≤–µ—Å–∞–º
  function weightedRandom(weights) {
    const sum = weights.reduce((acc, cur) => acc + cur.weight, 0);
    let rnd = Math.random() * sum;
    for (const item of weights) {
      if (rnd < item.weight) return item.value;
      rnd -= item.weight;
    }
    return weights[weights.length -1].value;
  }

  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É 5000 –≤ –º–∞—Å—Å–∏–≤–µ
  function generateCells() {
    cellsData = [];

    // –°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞–≤–∏–º –æ–¥–Ω—É 5000 —Å–ª—É—á–∞–π–Ω–æ
    const guaranteedIndex = Math.floor(Math.random() * TOTAL_CELLS);
    for(let i=0; i<TOTAL_CELLS; i++) {
      if(i === guaranteedIndex) {
        cellsData[i] = { type: 'reward', value: 5000 };
        continue;
      }
      // –†–µ—à–∞–µ–º –±–æ–º–±–∞ –∏–ª–∏ —Å—É–º–º–∞
      if(Math.random() < bombChance) {
        cellsData[i] = { type: 'bomb' };
      } else {
        let vals = currentSource === 'twitch' ? twitchValues : youtubeValues;
        let val = weightedRandom(vals);
        cellsData[i] = { type: 'reward', value: val };
      }
    }
  }

  // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É
  function createGrid() {
    grid.innerHTML = '';
    for(let i=0; i<TOTAL_CELLS; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.textContent = '';
      cell.addEventListener('click', () => onCellClick(i, cell));
      grid.appendChild(cell);
    }
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ —è—á–µ–π–∫–∏
  function openCell(i, cell) {
    const data = cellsData[i];
    cell.classList.add('opened');
    if(data.type === 'bomb') {
      cell.textContent = 'üí£';
      cell.classList.add('bomb');
    } else {
      animateNumber(cell, data.value);
    }
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–ª–∞
  function animateNumber(cell, target) {
    let value = 0;
    let step = Math.ceil(target / 20);
    const interval = setInterval(() => {
      value += step;
      if(value >= target) {
        value = target;
        clearInterval(interval);
      }
      cell.textContent = value;
    }, 30);
  }

  // –ö–ª–∏–∫ –ø–æ —è—á–µ–π–∫–µ
  function onCellClick(i, cell) {
    if(selectedIndex !== null) return; // —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞ —è—á–µ–π–∫–∞
    openCell(i, cell);
    selectedIndex = i;
    currentReward = cellsData[i].type === 'reward' ? cellsData[i].value : 0;
    cell.classList.add('selected');
    controls.style.display = 'flex';
    showAllBtn.style.display = 'inline-block';
    upgradeBtn.style.display = cellsData[i].type === 'reward' ? 'inline-block' : 'none';
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —è—á–µ–π–∫–∏
  function showAllCells() {
    const cells = document.querySelectorAll('.cell');
    cells.forEach((cell, idx) => {
      if(idx === selectedIndex) return; // —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞ –∏ –ø–æ–¥—Å–≤–µ—á–µ–Ω–∞
      openCell(idx, cell);
    });
    showAllBtn.style.display = 'none';
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É–º–º—ã –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ
  function upgradeReward() {
    // 50% —à–∞–Ω—Å —á—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
    if(Math.random() > 0.5) {
      alert('–£–¥–∞—á–∞ –Ω–µ –Ω–∞ —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ! –°—É–º–º–∞ —Å–≥–æ—Ä–µ–ª–∞!');
      currentReward = 0;
      const cell = document.querySelector(`.cell[data-index='${selectedIndex}']`);
      if(cell) {
        cell.textContent = '';
        cell.classList.remove('opened', 'selected', 'bomb');
      }
      selectedIndex = null;
      controls.style.display = 'none';
      return;
    }
    // –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ä—É–ª–µ—Ç–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ x2 –∏–ª–∏ —Å–≥–æ—Ä–∞–Ω–∏—è
    startRoulette();
  }

  // –†—É–ª–µ—Ç–∫–∞
  const segments = [
    {color: 'green', label: 'x2', multiplier: 2},
    {color: 'red', label: '–°–≥–æ—Ä–µ–ª–æ', multiplier: 0},
    {color: 'green', label: 'x2', multiplier: 2},
    {color: 'red', label: '–°–≥–æ—Ä–µ–ª–æ', multiplier: 0},
    {color: 'green', label: 'x2', multiplier: 2},
    {color: 'red', label: '–°–≥–æ—Ä–µ–ª–æ', multiplier: 0},
  ];
  const segmentCount = segments.length;
  const segmentAngle = (2 * Math.PI) / segmentCount;

  let rouletteAngle = 0;
  let spinning = false;
  let spinStartTime = null;
  let spinDuration = 4000;
  let finalSegmentIndex = null;

  function drawRoulette() {
    const radius = rouletteCanvas.width / 2;
    ctx.clearRect(0, 0, rouletteCanvas.width, rouletteCanvas.height);
    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(rouletteAngle);

    for(let i=0; i < segmentCount; i++) {
      const seg = segments[i];
      ctx.beginPath();
      ctx.fillStyle = seg.color;
      ctx.moveTo(0,0);
      ctx.arc(0, 0, radius, i*segmentAngle, (i+1)*segmentAngle);
      ctx.lineTo(0,0);
      ctx.fill();

      // –¢–µ–∫—Å—Ç
      ctx.fillStyle = 'black';
      ctx.font = 'bold 20px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const textAngle = i*segmentAngle + segmentAngle/2;
      const textX = Math.cos(textAngle) * radius * 0.6;
      const textY = Math.sin(textAngle) * radius * 0.6;
      ctx.fillText(seg.label, textX, textY);
    }

    ctx.restore();
  }

  function animateRoulette(timestamp) {
    if(!spinStartTime) spinStartTime = timestamp;
    const elapsed = timestamp - spinStartTime;

    // easing –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏—è
    const easeOut = t => 1 - Math.pow(1 - t, 3);

    let progress = Math.min(elapsed / spinDuration, 1);
    const easedProgress = easeOut(progress);

    // –£–≥–æ–ª –∫—Ä—É—Ç–∏—Ç—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑ + –¥–æ –Ω—É–∂–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
    const rotations = 6; // —Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤
    const finalAngle = rotations * 2 * Math.PI + (segmentCount - finalSegmentIndex) * segmentAngle - segmentAngle/2;

    rouletteAngle = finalAngle * easedProgress;
    drawRoulette();

    if(progress < 1) {
      requestAnimationFrame(animateRoulette);
    } else {
      finishRoulette();
    }
  }

  function finishRoulette() {
    const cell = document.querySelector(`.cell[data-index='${selectedIndex}']`);
    if(!cell) return;

    const seg = segments[finalSegmentIndex];
    if(seg.multiplier === 2) {
      // –£–¥–≤–∞–∏–≤–∞–µ–º —Å—É–º–º—É
      currentReward *= 2;
      animateNumber(cell, currentReward);
      alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ù–∞–≥—Ä–∞–¥–∞ —É–¥–≤–æ–µ–Ω–∞!');
    } else {
      // –°–≥–æ—Ä–∞–µ—Ç
      alert('–£–≤—ã, –Ω–∞–≥—Ä–∞–¥–∞ —Å–≥–æ—Ä–µ–ª–∞!');
      currentReward = 0;
      cell.textContent = '';
      cell.classList.remove('opened', 'selected', 'bomb');
      selectedIndex = null;
      controls.style.display = 'none';
    }
    rouletteContainer.style.display = 'none';
    upgradeBtn.disabled = false;
  }

  function startRoulette() {
    if(spinning) return;
    spinning = true;
    upgradeBtn.disabled = true;
    rouletteContainer.style.display = 'block';
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç
    finalSegmentIndex = Math.floor(Math.random() * segmentCount);
    spinStartTime = null;
    requestAnimationFrame(animateRoulette);
  }

  // –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Å–º–µ–Ω—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (Twitch/YouTube)
  function createSourceButtons() {
    const container = document.createElement('div');
    container.style.marginBottom = '20px';
    container.style.display = 'flex';
    container.style.gap = '15px';

    const twitchBtn = document.createElement('button');
    twitchBtn.textContent = 'Twitch';
    twitchBtn.style.padding = '10px 20px';
    twitchBtn.style.fontSize = '16px';
    twitchBtn.style.cursor = 'pointer';
    twitchBtn.style.fontWeight = 'bold';

    const youtubeBtn = document.createElement('button');
    youtubeBtn.textContent = 'YouTube';
    youtubeBtn.style.padding = '10px 20px';
    youtubeBtn.style.fontSize = '16px';
    youtubeBtn.style.cursor = 'pointer';
    youtubeBtn.style.fontWeight = 'bold';

    twitchBtn.onclick = () => {
      currentSource = 'twitch';
      initGame();
      twitchBtn.disabled = true;
      youtubeBtn.disabled = false;
    };
    youtubeBtn.onclick = () => {
      currentSource = 'youtube';
      initGame();
      twitchBtn.disabled = false;
      youtubeBtn.disabled = true;
    };

    container.appendChild(twitchBtn);
    container.appendChild(youtubeBtn);

    document.body.insertBefore(container, grid);
    twitchBtn.disabled = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±—Ä–∞–Ω Twitch
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
  function initGame() {
    selectedIndex = null;
    currentReward = 0;
    controls.style.display = 'none';
    rouletteContainer.style.display = 'none';
    upgradeBtn.disabled = false;
    generateCells();
    createGrid();
  }

  // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  showAllBtn.onclick = () => {
    showAllCells();
  };
  upgradeBtn.onclick = () => {
    upgradeReward();
  };

  // –°—Ç–∞—Ä—Ç—É–µ–º
  createSourceButtons();
  initGame();

</script>
</body>
</html>
