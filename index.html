<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner</title>
<style>
  /* –°–±—Ä–æ—Å –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background: url('extrim.png') no-repeat center center fixed;
    background-size: cover;
    color: white;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    box-sizing: border-box;
    min-height: 100vh;
  }

  #container {
    display: flex;
    gap: 30px;
    width: 100%;
    max-width: 1000px;
    justify-content: center;
    align-items: flex-start;
  }

  main {
    flex-grow: 1;
    max-width: 520px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    background: rgba(0,0,0,0.5);
    padding: 15px 30px;
    border-radius: 12px;
    margin-bottom: 20px;
    font-weight: 700;
    font-size: 28px;
    user-select: none;
  }

  /* –ö–Ω–æ–ø–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏ */
  #sourceButtons {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }

  #sourceButtons button {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    border: none;
    border-radius: 8px;
    padding: 10px 22px;
    cursor: pointer;
    font-weight: 700;
    font-size: 16px;
    color: black;
    box-shadow: 0 0 8px #FFD700;
    transition: background 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
  }

  #sourceButtons button:disabled {
    background: #555;
    box-shadow: none;
    cursor: not-allowed;
    color: #aaa;
  }

  #sourceButtons button:hover:not(:disabled) {
    background: linear-gradient(45deg, #FFA500, #FFD700);
    box-shadow: 0 0 14px #FFA500;
  }

  #sourceButtons svg {
    display: block;
    width: 22px;
    height: 22px;
  }

  /* –ü–æ–ª–µ —Å —è—á–µ–π–∫–∞–º–∏ */
  #grid {
    display: grid;
    grid-template-columns: repeat(8, 60px);
    grid-template-rows: repeat(8, 60px);
    gap: 6px;
    user-select: none;
  }

  .cell {
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.5);
    font-weight: 700;
    font-size: 18px;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.25s, transform 0.2s;
  }

  .cell:hover:not(.opened) {
    background-color: rgba(255,255,255,0.35);
    transform: scale(1.05);
  }

  .opened {
    cursor: default;
    background-color: rgba(0,0,0,0.7);
  }

  .selected {
    background-color: rgba(255,0,0,0.7);
  }

  .bomb {
    animation: bombFlash 0.6s infinite alternate;
  }

  @keyframes bombFlash {
    from { background-color: rgba(255, 0, 0, 0.7); }
    to { background-color: rgba(150, 0, 0, 0.9); }
  }

  /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  #controls {
    margin-top: 20px;
    display: flex;
    gap: 15px;
    user-select: none;
  }

  #showAllBtn, #upgradeBtn {
    padding: 12px 26px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    color: black;
    box-shadow: 0 0 8px #FFD700;
    transition: background 0.3s ease, box-shadow 0.3s ease;
  }

  #showAllBtn:hover, #upgradeBtn:hover {
    background: linear-gradient(45deg, #FFA500, #FFD700);
    box-shadow: 0 0 14px #FFA500;
  }

  #upgradeBtn:disabled {
    background: #666;
    box-shadow: none;
    cursor: not-allowed;
  }

  /* –†—É–ª–µ—Ç–∫–∞ —Å–±–æ–∫—É */
  #rouletteContainer {
    width: 320px;
    height: 320px;
    position: relative;
    border: 6px solid gold;
    border-radius: 50%;
    background: #222;
    box-shadow: 0 0 15px gold;
    overflow: visible;
    user-select: none;
  }

  #roulette {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: block;
  }

  #arrow {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid #88cc88;
    z-index: 20;
    filter: drop-shadow(0 0 2px #333);
  }
</style>
</head>
<body>

<div id="container">
  <main>
    <h1>EXTRIM Miner</h1>
    <div id="sourceButtons">
      <button id="twitchBtn" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#9146FF"><path d="M2 2v20l4-4h6l6-6V2H2zm15 6h-2v5h2V8zM9 8H7v5h2V8z"/></svg>
        Twitch
      </button>
      <button id="youtubeBtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FF0000">
          <path d="M10 15l5.19-3L10 9v6z"/>
          <path d="M21.8 7.5c-.2-1.5-1.5-2.7-3-2.9C15.5 4 12 4 12 4s-3.5 0-6 .6c-1.5.2-2.8 1.4-3 2.9C2 9 2 12 2 12s0 3 .6 4.5c.2 1.5 1.5 2.7 3 2.9 2.5.6 6 .6 6 .6s3.5 0 6-.6c1.5-.2 2.8-1.4 3-2.9.6-1.5.6-4.5.6-4.5s0-3-.6-4.5z"/>
        </svg>
        YouTube
      </button>
    </div>

    <div id="grid"></div>

    <div id="controls" style="display:none;">
      <button id="showAllBtn">–ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —è—á–µ–π–∫–∏</button>
      <button id="upgradeBtn">–£–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
    </div>
  </main>

  <div id="rouletteContainer" style="display:none;">
    <div id="arrow"></div>
    <canvas id="roulette" width="320" height="320"></canvas>
  </div>
</div>

<script>
  const grid = document.getElementById('grid');
  const showAllBtn = document.getElementById('showAllBtn');
  const upgradeBtn = document.getElementById('upgradeBtn');
  const controls = document.getElementById('controls');
  const rouletteContainer = document.getElementById('rouletteContainer');
  const rouletteCanvas = document.getElementById('roulette');
  const ctx = rouletteCanvas.getContext('2d');

  const twitchBtn = document.getElementById('twitchBtn');
  const youtubeBtn = document.getElementById('youtubeBtn');

  const ROWS = 8;
  const COLS = 8;
  const TOTAL_CELLS = ROWS * COLS;

  const twitchValues = [
    {value: 1000, weight: 30},
    {value: 1500, weight: 25},
    {value: 2000, weight: 20},
    {value: 2500, weight: 15},
    {value: 5000, weight: 8},
  ];

  const youtubeValues = [
    {value: 1000, weight: 30},
    {value: 1500, weight: 25},
    {value: 2000, weight: 20},
    {value: 2500, weight: 15},
    {value: 5000, weight: 8},
    {value: 10000, weight: 2},
  ];

  let currentSource = 'twitch';
  const bombChance = 0.2;

  let cellsData = [];
  let selectedIndex = null;
  let currentReward = 0;
  let rouletteSpinning = false;
  let gameBlocked = false;

  twitchBtn.addEventListener('click', () => {
    if(gameBlocked) return;
    currentSource = 'twitch';
    twitchBtn.disabled = true;
    youtubeBtn.disabled = false;
    resetGame();
  });

  youtubeBtn.addEventListener('click', () => {
    if(gameBlocked) return;
    currentSource = 'youtube';
    youtubeBtn.disabled = true;
    twitchBtn.disabled = false;
    resetGame();
  });

  function weightedRandom(weights) {
    const sum = weights.reduce((acc, cur) => acc + cur.weight, 0);
    let rnd = Math.random() * sum;
    for (const item of weights) {
      if (rnd < item.weight) return item.value;
      rnd -= item.weight;
    }
    return weights[weights.length -1].value;
  }

  function generateCells() {
    cellsData = [];
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –±–æ–ª—å—à—É—é —Å—É–º–º—É 5000 (–∏–ª–∏ 10000 –¥–ª—è —é—Ç—É–±)
    const guaranteedValue = currentSource === 'twitch' ? 5000 : 10000;
    const guaranteedIndex = Math.floor(Math.random() * TOTAL_CELLS);

    for(let i=0; i<TOTAL_CELLS; i++) {
      if(i === guaranteedIndex) {
        cellsData[i] = { type: 'reward', value: guaranteedValue };
        continue;
      }
      if(Math.random() < bombChance) {
        cellsData[i] = { type: 'bomb' };
      } else {
        let vals = currentSource === 'twitch' ? twitchValues : youtubeValues;
        let val = weightedRandom(vals);
        cellsData[i] = { type: 'reward', value: val };
      }
    }
  }

  function createGrid() {
    grid.innerHTML = '';
    for(let i=0; i<TOTAL_CELLS; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.textContent = '';
      cell.addEventListener('click', () => onCellClick(i, cell));
      grid.appendChild(cell);
    }
  }

  function openCell(i, cell) {
    const data = cellsData[i];
    cell.classList.add('opened');
    if(data.type === 'bomb') {
      cell.textContent = 'üí£';
      cell.classList.add('bomb');
    } else {
      animateNumber(cell, data.value);
    }
  }

  function animateNumber(cell, target) {
    let value = parseInt(cell.textContent) || 0;
    let start = value;
    let diff = target - start;
    let duration = 600;
    let startTime = null;

    function step(timestamp) {
      if(!startTime) startTime = timestamp;
      let progress = timestamp - startTime;
      let percent = Math.min(progress / duration, 1);
      let current = Math.floor(start + diff * percent);
      cell.textContent = current;
      if(percent < 1) {
        requestAnimationFrame(step);
      } else {
        cell.textContent = target;
      }
    }
    requestAnimationFrame(step);
  }

  function onCellClick(i, cell) {
    if(gameBlocked || selectedIndex !== null) return;
    openCell(i, cell);
    selectedIndex = i;
    currentReward = cellsData[i].type === 'reward' ? cellsData[i].value : 0;
    cell.classList.add('selected');
    controls.style.display = 'flex';
    showAllBtn.style.display = 'inline-block';
    upgradeBtn.style.display = cellsData[i].type === 'reward' ? 'inline-block' : 'none';
  }

  function showAllCells() {
    const cells = document.querySelectorAll('.cell');
    cells.forEach((cell, idx) => {
      if(idx === selectedIndex) return;
      openCell(idx, cell);
    });
    showAllBtn.style.display = 'none';
  }

  // –†—É–ª–µ—Ç–∫–∞

  const segments = [
    {color: '#a3d9a5', label: 'x2', multiplier: 2},
    {color: '#e7a3a3', label: '–°–≥–æ—Ä–µ–ª–æ', multiplier: 0},
    {color: '#a3d9a5', label: 'x2', multiplier: 2},
    {color: '#e7a3a3', label: '–°–≥–æ—Ä–µ–ª–æ', multiplier: 0},
    {color: '#a3d9a5', label: 'x2', multiplier: 2},
    {color: '#e7a3a3', label: '–°–≥–æ—Ä–µ–ª–æ', multiplier: 0},
  ];
  const segmentCount = segments.length;
  const segmentAngle = (2 * Math.PI) / segmentCount;

  let rouletteAngle = 0;
  let spinning = false;
  let spinStartTime = null;
  let spinDuration = 4000;
  let finalSegmentIndex = null;

  function drawRoulette() {
    const radius = rouletteCanvas.width / 2;
    ctx.clearRect(0, 0, rouletteCanvas.width, rouletteCanvas.height);
    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(rouletteAngle);

    for(let i=0; i < segmentCount; i++) {
      const seg = segments[i];
      ctx.beginPath();
      ctx.fillStyle = seg.color;
      ctx.moveTo(0,0);
      ctx.arc(0, 0, radius, i*segmentAngle, (i+1)*segmentAngle);
      ctx.lineTo(0,0);
      ctx.fill();

      ctx.fillStyle = 'black';
      ctx.font = 'bold 20px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const textAngle = i*segmentAngle + segmentAngle/2;
      const textX = Math.cos(textAngle) * radius * 0.6;
      const textY = Math.sin(textAngle) * radius * 0.6;
      ctx.fillText(seg.label, textX, textY);
    }

    ctx.restore();
  }

  function animateRoulette(timestamp) {
    if(!spinStartTime) spinStartTime = timestamp;
    const elapsed = timestamp - spinStartTime;

    const easeOut = t => 1 - Math.pow(1 - t, 3);
    let progress = Math.min(elapsed / spinDuration, 1);
    const easedProgress = easeOut(progress);

    const rotations = 6;
    const finalAngle = rotations * 2 * Math.PI + (segmentCount - finalSegmentIndex) * segmentAngle - segmentAngle/2;

    rouletteAngle = finalAngle * easedProgress;
    drawRoulette();

    if(progress < 1) {
      requestAnimationFrame(animateRoulette);
    } else {
      finishRoulette();
    }
  }

  function finishRoulette() {
    const cell = document.querySelector(`.cell[data-index='${selectedIndex}']`);
    if(!cell) return;

    const seg = segments[finalSegmentIndex];
    if(seg.multiplier === 2) {
      currentReward *= 2;
      animateNumber(cell, currentReward);
      alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ù–∞–≥—Ä–∞–¥–∞ —É–¥–≤–æ–µ–Ω–∞!');
    } else {
      alert('–£–≤—ã, –Ω–∞–≥—Ä–∞–¥–∞ —Å–≥–æ—Ä–µ–ª–∞! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
      currentReward = 0;
      cell.textContent = '';
      cell.classList.remove('opened', 'selected', 'bomb');
      selectedIndex = null;
      controls.style.display = 'none';
      gameBlocked = true;
    }
    rouletteContainer.style.display = 'none';
    upgradeBtn.disabled = false;
    rouletteSpinning = false;
  }

  function startRoulette() {
    if(rouletteSpinning) return;
    if(currentReward === 0) {
      alert('–ù–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!');
      return;
    }
    rouletteSpinning = true;
    upgradeBtn.disabled = true;
    rouletteContainer.style.display = 'block';

    spinStartTime = null;
    // –°–ª—É—á–∞–π–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä—É–ª–µ—Ç–∫–∏
    finalSegmentIndex = Math.floor(Math.random() * segmentCount);

    request
