<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap');

  body {
    margin: 0;
    font-family: 'Roboto Slab', serif;
    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    user-select: none;
  }
  h1 {
    margin: 20px 0 10px;
    font-size: 2.8rem;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
  }
  #platformButtons {
    margin-bottom: 15px;
    display: flex;
    gap: 20px;
  }
  .platform-btn {
    cursor: pointer;
    padding: 8px 15px 8px 40px;
    position: relative;
    border-radius: 8px;
    border: 2px solid transparent;
    font-weight: 700;
    font-size: 1.2rem;
    color: #eee;
    background: rgba(0,0,0,0.5);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
  }
  .platform-btn img {
    position: absolute;
    left: 10px;
    width: 24px;
    height: 24px;
  }
  .platform-btn.active {
    border-color: gold;
    box-shadow: 0 0 10px gold;
    color: gold;
    background: rgba(0,0,0,0.8);
  }

  #grid {
    display: grid;
    grid-template-columns: repeat(8, 55px);
    grid-template-rows: repeat(8, 55px);
    gap: 8px;
    margin-bottom: 20px;
  }
  .cell {
    background: rgba(0,0,0,0.6);
    border-radius: 8px;
    border: 2px solid rgba(255,255,255,0.3);
    cursor: pointer;
    font-weight: 700;
    font-size: 1.2rem;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    user-select: none;
    position: relative;
  }
  .cell:hover:not(.clicked) {
    background: rgba(255, 215, 0, 0.3);
    border-color: gold;
  }
  .cell.clicked {
    cursor: default;
    background: rgba(0,0,0,0.8);
    border-color: gold;
    color: #00ff00;
  }
  .cell.bomb {
    color: #ff3b3b;
    font-size: 1.6rem;
    animation: bombPulse 1s infinite alternate;
  }
  @keyframes bombPulse {
    0% { color: #ff3b3b; text-shadow: 0 0 10px #ff3b3b;}
    100% { color: #ff0000; text-shadow: 0 0 20px #ff0000;}
  }
  .cell.bomb.exploding {
    animation: explodeAnim 1s forwards;
  }
  @keyframes explodeAnim {
    0% {
      color: #ff0000;
      text-shadow: 0 0 20px #ff0000;
      transform: scale(1);
    }
    50% {
      color: #fff;
      text-shadow: 0 0 50px #fff;
      transform: scale(2);
    }
    100% {
      opacity: 0;
      transform: scale(2.5);
    }
  }
  .cell.reward {
    color: #00ff00;
  }
  .cell.burned {
    color: #ff5555;
    font-weight: 900;
    animation: burnFade 3s forwards;
    position: relative;
  }
  .cell.burned::after {
    content: "üíî";
    position: absolute;
    top: 2px;
    right: 4px;
    font-size: 1.2rem;
    animation: heartCry 3s forwards;
  }
  @keyframes burnFade {
    0% { color: #ff5555; }
    100% { color: #440000; }
  }
  @keyframes heartCry {
    0% { opacity: 1; }
    100% { opacity: 0; }
  }

  #rouletteContainer {
    position: fixed;
    top: 50%;
    right: 20px;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.7);
    border-radius: 12px;
    padding: 20px;
    width: 220px;
    box-shadow: 0 0 15px gold;
    user-select: none;
  }
  #roulette {
    position: relative;
    width: 180px;
    height: 180px;
    border-radius: 50%;
    overflow: hidden;
    border: 4px solid #222;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.7);
  }
  #roulette svg {
    transform: rotate(0deg);
    transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
  }
  #roulette path.green {
    fill: #1dbc1d;
  }
  #roulette path.red {
    fill: #d32222;
  }
  #roulette text {
    fill: #fff;
    font-weight: 700;
    font-size: 18px;
    pointer-events: none;
  }
  #arrow {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 25px solid gold;
    filter: drop-shadow(0 0 5px gold);
    z-index: 10;
  }

  #showHiddenBtn {
    margin-top: 12px;
    padding: 10px;
    width: 100%;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    background: gold;
    color: black;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 0 12px gold;
    user-select: none;
  }
  #showHiddenBtn:disabled {
    background: #999;
    cursor: default;
    box-shadow: none;
  }
</style>
</head>
<body>

<h1>EXTRIM Miner</h1>

<div id="platformButtons">
  <div class="platform-btn active" id="twitchBtn">
    <img src="https://cdn-icons-png.flaticon.com/512/733/733635.png" alt="Twitch" />
    Twitch
  </div>
  <div class="platform-btn" id="youtubeBtn">
    <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube" />
    YouTube
  </div>
</div>

<div id="grid"></div>

<button id="showHiddenBtn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —è—á–µ–π–∫–∏</button>

<div id="rouletteContainer" style="display:none;">
  <div id="arrow"></div>
  <div id="roulette">
    <svg width="180" height="180" viewBox="0 0 180 180" xmlns="http://www.w3.org/2000/svg" >
      <circle cx="90" cy="90" r="85" fill="none" stroke="none" />
      <path class="green" d="M90,5 A85,85 0 0,1 175,90 L90,90 Z" />
      <path class="red" d="M175,90 A85,85 0 0,1 90,175 L90,90 Z" />
      <text x="45" y="50" transform="rotate(-45 45,50)">x2</text>
      <text x="120" y="130" transform="rotate(45 120,130)">—Å–≥–æ—Ä–∞–µ—Ç</text>
    </svg>
  </div>
</div>

<script>
  const rewardsTwitch = [1000, 1500, 2000, 2500, 5000];
  const rewardsYouTube = [1000, 1500, 2000, 2500, 5000, 10000];
  const bombChance = 0.2; // 20% —à–∞–Ω—Å –±–æ–º–±—ã

  let currentPlatform = 'twitch'; // twitch –∏–ª–∏ youtube
  let cells = [];
  let valuesMap = []; // —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —è—á–µ–µ–∫
  let selectedCell = null;
  let rouletteActive = false;
  let sumBurned = false;

  const grid = document.getElementById('grid');
  const showHiddenBtn = document.getElementById('showHiddenBtn');
  const rouletteContainer = document.getElementById('rouletteContainer');
  const arrow = document.getElementById('arrow');

  // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –∫–Ω–æ–ø–∫–∏
  const twitchBtn = document.getElementById('twitchBtn');
  const youtubeBtn = document.getElementById('youtubeBtn');

  twitchBtn.onclick = () => {
    if(rouletteActive) return;
    currentPlatform = 'twitch';
    twitchBtn.classList.add('active');
    youtubeBtn.classList.remove('active');
    resetGame();
  };
  youtubeBtn.onclick = () => {
    if(rouletteActive) return;
    currentPlatform = 'youtube';
    youtubeBtn.classList.add('active');
    twitchBtn.classList.remove('active');
    resetGame();
  };

  function resetGame() {
    selectedCell = null;
    sumBurned = false;
    rouletteActive = false;
    rouletteContainer.style.display = 'none';
    showHiddenBtn.disabled = true;
    grid.innerHTML = '';
    valuesMap = [];
    cells = [];
    generateValues();
    renderGrid();
  }

  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—É–º–º–∞ 5000 –∏–ª–∏ 10000 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  function generateValues() {
    const rewards = currentPlatform === 'twitch' ? rewardsTwitch : rewardsYouTube;
    const totalCells = 64;
    const guaranteedLarge = currentPlatform === 'twitch' ? 5000 : 10000;
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–∞—Å—Å–∏–≤ —Å–Ω–∞—á–∞–ª–∞ –±–æ–º–±–∞–º–∏ –∏ —Å—É–º–º–∞–º–∏ –ø–æ —à–∞–Ω—Å–∞–º
    for(let i=0; i<totalCells; i++) {
      if(Math.random() < bombChance) {
        valuesMap[i] = 'bomb';
      } else {
        // –†–∞–Ω–¥–æ–º–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º —Å—É–º–º—É –∏–∑ –º–∞—Å—Å–∏–≤–∞ —Å —É—á—ë—Ç–æ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ (–±–æ–ª—å—à–µ —Å—É–º–º–∞ ‚Äî –º–µ–Ω—å—à–µ —à–∞–Ω—Å)
        valuesMap[i] = weightedRandomReward(rewards);
      }
    }
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É –±–æ–ª—å—à—É—é —Å—É–º–º—É
    if(!valuesMap.includes(guaranteedLarge)) {
      let replaceIndex = Math.floor(Math.random() * totalCells);
      valuesMap[replaceIndex] = guaranteedLarge;
    }
  }

  // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ —Å—É–º–º—ã, —á–µ–º –≤—ã—à–µ —Å—É–º–º–∞ ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ —à–∞–Ω—Å
  function weightedRandomReward(rewards) {
    // –ü—Ä–∏–º–µ—Ä –≤–µ—Å–æ–≤ (–æ–±—Ä–∞—Ç–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å): 1000 ‚Äî 5, 1500 ‚Äî 4, 2000 ‚Äî 3, 2500 ‚Äî 2, 5000 ‚Äî 1, 10000 ‚Äî 0.5
    // –î–ª—è twitch —É–±–µ—Ä—ë–º 10000
    const weightsMap = {
      1000: 5,
      1500: 4,
      2000: 3,
      2500: 2,
      5000: 1,
      10000: 0.5
    };
    // –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
    let filteredRewards = rewards;
    let totalWeight = 0;
    for(let r of filteredRewards) {
      totalWeight += weightsMap[r];
    }
    let rnd = Math.random() * totalWeight;
    for(let r of filteredRewards) {
      rnd -= weightsMap[r];
      if(rnd <= 0) return r;
    }
    return filteredRewards[0]; // –Ω–∞ –≤—Å—è–∫–∏–π
  }

  function renderGrid() {
    for(let i=0; i<64; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.onclick = () => onCellClick(cell, i);
      grid.appendChild(cell);
      cells.push(cell);
    }
  }

  function onCellClick(cell, idx) {
    if(rouletteActive || sumBurned) return; // –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ –≤—Ä–µ–º—è —Ä—É–ª–µ—Ç–∫–∏ –∏–ª–∏ –ø–æ—Å–ª–µ —Å–≥–æ—Ä–∞–Ω–∏—è
    if(selectedCell) return; // —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —è—á–µ–π–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–∞
    selectedCell = cell;
    showHiddenBtn.disabled = false;
    cell.classList.add('clicked');
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å—É–º–º—É –∏–ª–∏ –±–æ–º–±—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    if(valuesMap[idx] === 'bomb') {
      cell.classList.add('bomb');
      explodeBomb(cell);
      lockRoulette();
    } else {
      animateNumber(cell, 0, valuesMap[idx]);
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É –¥–ª—è —É–º–Ω–æ–∂–µ–Ω–∏—è
      rouletteContainer.style.display = 'block';
    }
  }

  function animateNumber(cell, start, end) {
    const stepCount = 20;
    const step = Math.ceil((end - start) / stepCount);
    let current = start;
    let count = 0;
    const interval = setInterval(() => {
      current += step;
      count++;
      if(current >= end || count >= stepCount) {
        current = end;
        clearInterval(interval);
      }
      cell.textContent = current.toLocaleString();
    }, 40);
  }

  function explodeBomb(cell) {
    cell.textContent = 'üí•';
    cell.classList.add('exploding');
    setTimeout(() => {
      cell.textContent = 'üí•';
      // –ú–æ–∂–Ω–æ —Ç—É—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–ª–∏ –∑–≤—É–∫
    }, 1000);
  }

  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä —Ü–µ–ø—å—é)
  function lockRoulette() {
    rouletteActive = true;
    arrow.style.borderBottomColor = '#666';
  }

  // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä—É–ª–µ—Ç–∫–∏
  function unlockRoulette() {
    rouletteActive = false;
    arrow.style.borderBottomColor = 'gold';
  }

  // –†—É–ª–µ—Ç–∫–∞
  const roulette = document.querySelector('#roulette svg');
  rouletteContainer.onclick = () => {
    if(rouletteActive) return;
    if(!selectedCell) return;
    rouletteActive = true;
    let spinAngle = Math.floor(Math.random() * 360) + 720; // 2-4 –æ–±–æ—Ä–æ—Ç–∞ + —Ä–∞–Ω–¥–æ–º
    roulette.style.transition = 'transform 4s cubic-bezier(0.33, 1, 0.68, 1)';
    roulette.style.transform = `rotate(${spinAngle}deg)`;
    setTimeout(() => {
      // –û–ø—Ä–µ–¥–µ–ª–∏–º –∏—Ç–æ–≥
      let normalized = spinAngle % 360;
      // 0-180 ‚Äî –∑–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ (–≤—ã–∏–≥—Ä—ã—à), 180-360 ‚Äî –∫—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞ (—Å–≥–æ—Ä–∞–Ω–∏–µ)
      if(normalized <= 180) {
        multiplyReward();
      } else {
        burnReward();
      }
      roulette.style.transition = '';
      roulette.style.transform = 'rotate(0deg)';
      rouletteActive = false;
      rouletteContainer.style.display = 'none';
    }, 4000);
  };

  function multiplyReward() {
    if(!selectedCell) return;
    let currentValue = parseInt(selectedCell.textContent.replace(/\s/g, ''));
    let newValue = currentValue * 2;
    animateNumber(selectedCell, currentValue, newValue);
    alert('–í—ã–ø–∞–ª –≤—ã–∏–≥—Ä—ã—à x2!');
  }

  function burnReward() {
    if(!selectedCell) return;
    selectedCell.classList.add('burned');
    selectedCell.textContent = '–°–≥–æ—Ä–µ–ª–æ';
    sumBurned = true;
    alert('–°—É–º–º–∞ —Å–≥–æ—Ä–µ–ª–∞ üíî');
    lockRoulette();
  }

  // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —è—á–µ–π–∫–∏
  showHiddenBtn.onclick = () => {
    if(!selectedCell) return;
    for(let i=0; i<cells.length; i++) {
      if(cells[i] !== selectedCell) {
        if(valuesMap[i] === 'bomb') {
          cells[i].textContent = 'üí£';
          cells[i].classList.add('bomb');
        }
