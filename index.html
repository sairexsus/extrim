<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXTRIM Miner</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('extrim.png') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    color: white;
  }
  h1 {
    margin: 20px 0 10px;
    background: rgba(0,0,0,0.6);
    padding: 10px 20px;
    border-radius: 12px;
  }
  .button-container {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }
  .channel-btn {
    display: flex;
    align-items: center;
    background: rgba(0,0,0,0.6);
    border: 2px solid white;
    border-radius: 8px;
    padding: 8px 15px;
    font-weight: bold;
    font-size: 16px;
    color: white;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s, border-color 0.3s;
  }
  .channel-btn:hover {
    background: rgba(255,255,255,0.15);
    border-color: gold;
  }
  .channel-btn img {
    width: 24px;
    height: 24px;
    margin-right: 8px;
  }

  #grid {
    display: grid;
    grid-template-columns: repeat(8, 60px);
    grid-template-rows: repeat(8, 60px);
    gap: 6px;
    margin-bottom: 15px;
    user-select: none;
  }
  .cell {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 6px;
    font-size: 18px;
    font-weight: bold;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
  }
  .cell:hover {
    transform: scale(1.05);
  }
  .cell.opened {
    background-color: rgba(0,0,0,0.6);
    cursor: default;
  }
  .cell.bomb {
    background-color: #b71c1c;
    animation: bombFlash 0.7s infinite alternate;
  }
  @keyframes bombFlash {
    from { background-color: #b71c1c; }
    to { background-color: #7f0000; }
  }
  .cell.reward {
    color: #00ff00;
  }

  #upgradeBtn {
    display: none;
    background: gold;
    color: black;
    font-weight: bold;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    padding: 12px 25px;
    cursor: pointer;
    margin-bottom: 15px;
  }
  #upgradeBtn:hover:not(:disabled) {
    background: #ffdd00;
  }
  #upgradeBtn:disabled {
    background: gray;
    cursor: default;
  }

  /* –†—É–ª–µ—Ç–∫–∞ —Å–±–æ–∫—É */
  #rouletteContainer {
    position: fixed;
    top: 50%;
    right: 20px;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.7);
    border-radius: 15px;
    padding: 20px;
    color: white;
    width: 200px;
    text-align: center;
    user-select: none;
  }
  #roulette {
    margin: 0 auto 15px;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    border: 6px solid white;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 15px gold;
  }
  #roulette .sector {
    position: absolute;
    width: 50%;
    height: 50%;
    top: 50%;
    left: 50%;
    transform-origin: 0% 0%;
    background: green;
    clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
    color: white;
    font-weight: bold;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding-left: 8px;
  }
  #roulette .sector.red {
    background: #b71c1c;
  }
  #rouletteArrow {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 25px solid gold;
    filter: drop-shadow(0 0 3px black);
    z-index: 10;
  }
  #spinBtn {
    background: gold;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
  }
  #spinBtn:disabled {
    background: gray;
    cursor: default;
  }
</style>
</head>
<body>

<h1>EXTRIM Miner</h1>

<div class="button-container">
  <div id="twitchBtn" class="channel-btn" title="–í—ã–±—Ä–∞—Ç—å Twitch (–¥–æ 5000)">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Twitch_logo_2019.svg" alt="Twitch" />
    Twitch
  </div>
  <div id="youtubeBtn" class="channel-btn" title="–í—ã–±—Ä–∞—Ç—å YouTube (–¥–æ 10000)">
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/42/YouTube_icon_%282013-2017%29.png" alt="YouTube" />
    YouTube
  </div>
</div>

<div id="grid"></div>

<button id="upgradeBtn" disabled>–£–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>

<!-- –†—É–ª–µ—Ç–∫–∞ -->
<div id="rouletteContainer" style="display:none;">
  <div id="rouletteArrow"></div>
  <div id="roulette">
    <!-- –°–µ–∫—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ JS -->
  </div>
  <button id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É</button>
</div>

<script>
  const grid = document.getElementById('grid');
  const upgradeBtn = document.getElementById('upgradeBtn');
  const twitchBtn = document.getElementById('twitchBtn');
  const youtubeBtn = document.getElementById('youtubeBtn');
  const rouletteContainer = document.getElementById('rouletteContainer');
  const roulette = document.getElementById('roulette');
  const spinBtn = document.getElementById('spinBtn');

  const twitchRewards = [1000, 1500, 2000, 2500, 5000];
  const youtubeRewards = [1000, 1500, 2000, 2500, 5000, 10000];
  let currentChannel = 'twitch'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  let currentRewards = twitchRewards;

  let cellsData = [];
  let openedCell = null;
  let upgradeUsed = false;
  let rouletteSpinning = false;

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–º–± –∏ —Å—É–º–º—ã —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∫—Ä—É–ø–Ω–æ–π —Å—É–º–º—ã
  function generateCells() {
    cellsData = [];
    let bombCount = 0;
    const bombChance = 0.2;
    const guaranteedLargeRewardCount = 1; // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ 1 –∫—Ä—É–ø–Ω–æ–µ —á–∏—Å–ª–æ (5000 –∏–ª–∏ 10000)

    // –°–Ω–∞—á–∞–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤, –≥–¥–µ 1 - –±–æ–º–±–∞, 0 - –Ω–∞–≥—Ä–∞–¥–∞
    for (let i = 0; i < 64; i++) {
      cellsData.push({ type: Math.random() < bombChance ? 'bomb' : 'reward', value: 0 });
    }

    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∫—Ä—É–ø–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É
    for (let i = 0; i < guaranteedLargeRewardCount; i++) {
      let idx;
      do {
        idx = Math.floor(Math.random() * 64);
      } while (cellsData[idx].type === 'bomb');
      cellsData[idx].value = currentRewards[currentRewards.length - 1];
    }

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã —Å–ª—É—á–∞–π–Ω–æ, —É—á–∏—Ç—ã–≤–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º–µ–Ω—å—à–∏—Ö —á–∏—Å–µ–ª –≤—ã—à–µ
    for (let i = 0; i < 64; i++) {
      if (cellsData[i].type === 'reward' && cellsData[i].value === 0) {
        cellsData[i].value = getRandomRewardWeighted();
      }
    }
  }

  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ –∏–∑ currentRewards —Å —É—á—ë—Ç–æ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ - —á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º —Ä–µ–∂–µ
  function getRandomRewardWeighted() {
    // –≤–µ—Å–∞: 1000 - 30%, 1500 - 25%, 2000 - 20%, 2500 - 15%, 5000 - 8%, 10000 - 2%
    const weights = {
      1000: 30,
      1500: 25,
      2000: 20,
      2500: 15,
      5000: 8,
      10000: 2
    };
    // –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Ç–µ–∫—É—â–∏–º –Ω–∞–≥—Ä–∞–¥–∞–º
    let filteredWeights = currentRewards.map(v => weights[v] || 0);
    let sumWeights = filteredWeights.reduce((a,b) => a+b, 0);
    let rnd = Math.random() * sumWeights;
    let cum = 0;
    for(let i=0; i<currentRewards.length; i++) {
      cum += filteredWeights[i];
      if(rnd <= cum) return currentRewards[i];
    }
    return currentRewards[0];
  }

  // –†–∏—Å—É–µ–º –ø–æ–ª–µ
  function drawGrid() {
    grid.innerHTML = '';
    for(let i=0; i<64; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.addEventListener('click', () => onCellClick(cell));
      grid.appendChild(cell);
    }
  }

  function onCellClick(cell) {
    if (openedCell || cell.classList.contains('opened')) return;
    const idx = parseInt(cell.dataset.index);
    const cellInfo = cellsData[idx];

    cell.classList.add('opened');

    if(cellInfo.type === 'bomb') {
      cell.classList.add('bomb');
      cell.textContent = 'üí£';
      // –ë–æ–º–±–∞ ‚Äî –ø–æ—Å–ª–µ –≤–∑—Ä—ã–≤–∞ –±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä
      openedCell = cell;
      upgradeBtn.disabled = true;
      upgradeBtn.style.display = 'none';
      rouletteContainer.style.display = 'none';
      alert('–ë–æ–º–±–∞! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
      return;
    } else {
      animateNumber(cell, cellInfo.value);
      cell.classList.add('reward');
      openedCell = cell;
      upgradeBtn.disabled = false;
      upgradeBtn.style.display = 'inline-block';
      rouletteContainer.style.display = 'block';
      upgradeUsed = false;
    }
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–æ—Å—Ç–∞ —á–∏—Å–ª–∞
  function animateNumber(cell, target) {
    let current = 0;
    const step = Math.max(10, Math.floor(target / 30));
    clearInterval(cell.animationInterval);
    cell.animationInterval = setInterval(() => {
      current += step;
      if(current >= target) {
        current = target;
        clearInterval(cell.animationInterval);
      }
      cell.textContent = current;
    }, 30);
  }

  // –£–ª—É—á—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
  upgradeBtn.addEventListener('click', () => {
    if(!openedCell || upgradeUsed) return;
    upgradeUsed = true;
    upgradeBtn.disabled = true;
    spinBtn.disabled = false;
  });

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
  twitchBtn.addEventListener('click', () => {
    if(openedCell) return alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –∏–≥—Ä—É!');
    currentChannel = 'twitch';
    currentRewards = twitchRewards;
    twitchBtn.style.borderColor = 'gold';
    youtubeBtn.style.borderColor = 'white';
    generateCells();
    drawGrid();
    upgradeBtn.style.display = 'none';
    rouletteContainer.style.display = 'none';
  });

  youtubeBtn.addEventListener('click', () => {
    if(openedCell) return alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –∏–≥—Ä—É!');
    currentChannel = 'youtube';
    currentRewards = youtubeRewards;
    youtubeBtn.style.borderColor = 'gold';
    twitchBtn.style.borderColor = 'white';
    generateCells();
    drawGrid();
    upgradeBtn.style.display = 'none';
    rouletteContainer.style.display = 'none';
  });

  // –†—É–ª–µ—Ç–∫–∞
  const sectors = [
    {color: 'green', text: '√ó2', multiplier: 2},
    {color: 'red', text: '–°–≥–æ—Ä–∞–µ—Ç', multiplier: 0},
    {color: 'green', text: '√ó2', multiplier: 2},
    {color: 'red', text: '–°–≥–æ—Ä–∞–µ—Ç', multiplier: 0},
    {color: 'green', text: '√ó2', multiplier: 2},
    {color: 'red', text: '–°–≥–æ—Ä–∞–µ—Ç', multiplier: 0},
    {color: 'green', text: '√ó2', multiplier: 2},
    {color: 'red', text: '–°–≥–æ—Ä–∞–µ—Ç', multiplier: 0}
  ];

  // –°–æ–∑–¥–∞–µ–º —Å–µ–∫—Ç–æ—Ä–∞ —Ä—É–ª–µ—Ç–∫–∏
  function createSectors() {
    roulette.innerHTML = '';
    const angleStep = 360 / sectors.length;
    sectors.forEach((sector, i) => {
      const div = document.createElement('div');
      div.classList.add('sector');
      div.style.backgroundColor = sector.color;
      div.style.transform = `rotate(${i * angleStep}deg) skewY(-${90 - angleStep}deg)`;
      div.textContent = sector.text;
      roulette.appendChild(div);
    });
  }
  createSectors();

  let rotation = 0;
  spinBtn.addEventListener('click', () => {
    if(rouletteSpinning) return;
    rouletteSpinning = true;
    spinBtn.disabled = true;

    // –ö—Ä—É—Ç–∏–º —Ä—É–ª–µ—Ç–∫—É –Ω–∞ —Ä–∞–Ω–¥–æ–º –æ—Ç 3 –¥–æ 6 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ + —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ–∫—Ç–æ—Ä
    const spins = Math.floor(Math.random() * 3) + 3;
    const sectorIndex = Math.floor(Math.random() * sectors.length);
    const anglePerSector = 360 / sectors.length;
    const finalRotation = spins * 360 + sectorIndex * anglePerSector + anglePerSector/2;

    // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    const duration = 4000;
    const start = performance.now();

    function animate(time) {
      const elapsed = time - start;
      if(elapsed < duration) {
        const progress = elapsed / duration;
        const easeOut = 1 - Math.pow(1 - progress, 3);
        roulette.style.transform = `rotate(${rotation + easeOut * (finalRotation - rotation)}deg)`;
        requestAnimationFrame(animate);
      } else {
        rotation = (rotation + (finalRotation - rotation)) % 360;
        roulette.style.transform = `rotate(${rotation}deg)`;
        rouletteSpinning = false;
        handleSpinResult(sectors[sectorIndex]);
      }
    }
    requestAnimationFrame(animate);
  });

  function handleSpinResult(sector) {
    if(sector.multiplier === 0) {
      alert('–£–≤—ã, —Å—É–º–º–∞ —Å–≥–æ—Ä–µ–ª–∞!');
      openedCell.textContent = '';
      openedCell.classList.remove('reward');
      openedCell.classList.add('bomb');
      openedCell.textContent = 'üí•';
      upgradeBtn.style.display = 'none';
      rouletteContainer.style.display = 'none';
      openedCell = null;
    } else {
      // –£–º–Ω–æ–∂–∞–µ–º —Å—É–º–º—É –≤ –æ—Ç–∫—Ä—ã—Ç–æ–π —è—á–µ–π–∫–µ
      let currentSum = parseInt(openedCell.textContent) || 0;
      let newSum = currentSum * sector.multiplier;
      animateNumber(openedCell, newSum);
      upgradeBtn.style.display = 'none';
      rouletteContainer.style.display = 'none';
    }
    upgradeBtn.disabled = true;
    spinBtn.disabled = true;
  }

  // –°—Ç–∞—Ä—Ç
  twitchBtn.style.borderColor = 'gold';
  generateCells();
  drawGrid();
  upgradeBtn.style.display = 'none';
  rouletteContainer.style.display = 'none';
</script>

</body>
</html>
